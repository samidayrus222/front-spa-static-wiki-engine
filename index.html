<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body>

    <h1>Hi!</h1>
    <div id="form-edit">

    </div>
    <div id="form-create">
        <input type="text" name="" placeholder="Title" id="title-create"><br><br>
        <input type="text" name="" placeholder="Content" id="content-create"><br><br>
        <input type="text" name="" placeholder="Tags" id="tags-create"><br><br>
    </div>
    <div id="data-details">
    </div>
    <button id="cancel">Cancel</button>
    <button id="create">Create Wiki</button>
    <button id="back-to-details">Back</button>
    <button id="back">Back</button>
    <button id="update">Update</button>
    <button id="edit">Edit Wiki</button>
    <button id="delete">Delete Wiki</button>
    <div id="data"></div>
    <button id="add">Add wiki</button>
    <!-- <h1>result.</h1> -->
    <!-- <h1><a href="https://www.google.com">Bismillah</a></h1> -->
    <script>
        $(document).ready(function () {
            $("#create").hide();
            $("#cancel").hide();
            $("#form-create").hide();
            $("#back").hide();
            $("#update").hide();
            $("#edit").hide();
            $("#delete").hide();
            $("#back-to-details").hide();
            $.ajax({
                type: "GET",
                url: "http://localhost:8000/articles",
                dataType: "json",
                success: function (response) {
                    var value;
                    var title, content, tags;
                    $.each(response.url, function (indexInArray, valueOfElement) {
                        $.ajax({
                            type: "GET",
                            url: "http://localhost:8000/articles/" + valueOfElement,
                            success: function (response) {
                                $("#data").append("<h1><a href='" + valueOfElement + "''>" + response.title + "</a></h1>");
                                $("a[href$='" + valueOfElement + "']").unbind().click(function (event) {
                                    value = valueOfElement;
                                    event.preventDefault();
                                    $.ajax({
                                        type: "GET",
                                        url: "http://localhost:8000/articles/" + valueOfElement,
                                        dataType: "json",
                                        success: function (result) {
                                            // $("#data-details").show();
                                            $("#data").hide();
                                            $("#add").hide();
                                            $("#data-details").append("<h1>" + result.title + "</h1>");
                                            $("#data-details").append("<p>" + result.content + "</p>");
                                            $("#back").show();
                                            $("#edit").show();
                                            $("#delete").show();
                                            $("#delete").unbind().click(function (e) {
                                                e.preventDefault();
                                                var $confirm = confirm("Are you sure want to delete?");
                                                if ($confirm) {
                                                    $("#data-details").empty();

                                                    $.ajax({
                                                        type: "DELETE",
                                                        dataType: "json",
                                                        contentType: "application/json",
                                                        url: "http://localhost:8000/article/" + valueOfElement,
                                                        success: function (response) {
                                                            $("#delete").hide();
                                                            $("#edit").hide();
                                                            $("#back").hide();
                                                            location.reload();
                                                        },
                                                        error: function () {
                                                            alert("Something went wrong");
                                                        }
                                                    });
                                                } else {
                                                }
                                            });

                                            console.log(valueOfElement);
                                            $("#back").on('click', function () {
                                                $("#data-details").empty();
                                                $("#data").show();
                                                $("#add").show();
                                                $("#back").hide();
                                                $("#edit").hide();
                                                $("#delete").hide();
                                            });

                                            $("#edit").on('click', function () {
                                                $("#data-details").empty();
                                                $("#edit").hide();
                                                $("#delete").hide();
                                                $("#back").hide();
                                                $("#form-edit").empty();
                                                $("#form-edit").append("<input type='text' id='title' value='" + result.title + "' required><br><br>");
                                                $("#form-edit").append("<input type='text' id='content' value='" + result.content + "' required><br><br>");
                                                $("#form-edit").append("<input type='text' id='tags' value='" + result.tags + "' required><br><br>");
                                                $("#back-to-details").show();
                                                $("#update").show();
                                                $("#update").unbind().click(function (e) {
                                                    e.preventDefault();
                                                    if ($("#title").val().replace(/^\s+|\s+$/g, "").length == 0 || $("#content").val().replace(/^\s+|\s+$/g, "").length == 0) {
                                                        alert("Title or Content not allowed to be empty");
                                                    }
                                                    else {
                                                        title = $("#title").val();
                                                        content = $("#content").val();
                                                        tags = [$("#tags").val()];
                                                        $.ajax({
                                                            type: "PUT",
                                                            url: "http://localhost:8000/articles/" + valueOfElement,
                                                            data: JSON.stringify({
                                                                title: title,
                                                                content: content,
                                                                tags: tags
                                                            }),
                                                            contentType: "application/json",
                                                            // dataType: "json",
                                                            success: function (response) {
                                                                alert("Wiki updated successfully");
                                                                $("#form-edit").empty();
                                                                $("#back-to-details").hide();
                                                                $("#update").hide();
                                                                $("#data").show();
                                                                $("#add").show();
                                                            },
                                                            error: function () {
                                                                alert("Update failed");
                                                            }
                                                        });
                                                    }
                                                });
                                                $("#back-to-details").unbind().click(function (e) {
                                                    e.preventDefault();
                                                    $("#form-edit").empty();
                                                    $("#back-to-details").hide();
                                                    $("#update").hide();
                                                    $("#data-details").append("<h1>" + result.title + "</h1>");
                                                    $("#data-details").append("<p>" + result.content + "</p>");
                                                    $("#back").show();
                                                    $("#edit").show();
                                                    $("#delete").show();
                                                });
                                                $("#back-to-details").on('click', function () {
                                                });
                                            });
                                        }
                                    });
                                });
                            },
                        });
                        // $("#data").append("<h1><a href='" + valueOfElement + "''>" + valueOfElement + "</a></h1>");
                        // $("a[href$='" + valueOfElement + "']").unbind().click(function (event) {
                        //     value = valueOfElement;
                        //     event.preventDefault();
                        //     $.ajax({
                        //         type: "GET",
                        //         url: "http://localhost:8000/articles/" + valueOfElement,
                        //         dataType: "json",
                        //         success: function (result) {
                        //             // $("#data-details").show();
                        //             $("#data").hide();
                        //             $("#add").hide();
                        //             $("#data-details").append("<h1>" + result.title + "</h1>");
                        //             $("#data-details").append("<p>" + result.content + "</p>");
                        //             $("#back").show();
                        //             $("#edit").show();
                        //             $("#delete").show();
                        //             $("#delete").unbind().click(function (e) {
                        //                 e.preventDefault();
                        //                 var $confirm = confirm("Are you sure want to delete?");
                        //                 if ($confirm) {
                        //                     $("#data-details").empty();

                        //                     $.ajax({
                        //                         type: "DELETE",
                        //                         dataType:  "json",
                        //                         contentType: "application/json",
                        //                         url: "http://localhost:8000/article/" + valueOfElement,
                        //                         success: function (response) {
                        //                             $("#delete").hide();
                        //                             $("#edit").hide();
                        //                             $("#back").hide();
                        //                             location.reload();
                        //                         },
                        //                         error: function () {  
                        //                             alert("Something went wrong");
                        //                         }
                        //                     });
                        //                 } else {
                        //                 }
                        //             });

                        //             console.log(valueOfElement);
                        //             $("#back").on('click', function () {
                        //                 $("#data-details").empty();
                        //                 $("#data").show();
                        //                 $("#add").show();
                        //                 $("#back").hide();
                        //                 $("#edit").hide();
                        //                 $("#delete").hide();
                        //             });

                        //             $("#edit").on('click', function () {
                        //                 $("#data-details").empty();
                        //                 $("#edit").hide();
                        //                 $("#delete").hide();
                        //                 $("#back").hide();
                        //                 $("#form-edit").empty();
                        //                 $("#form-edit").append("<input type='text' id='title' value='" + result.title + "' required><br><br>");
                        //                 $("#form-edit").append("<input type='text' id='content' value='" + result.content + "' required><br><br>");
                        //                 $("#form-edit").append("<input type='text' id='tags' value='" + result.tags + "' required><br><br>");
                        //                 $("#back-to-details").show();
                        //                 $("#update").show();
                        //                 $("#update").unbind().click(function (e) {
                        //                     e.preventDefault();
                        //                     if ($("#title").val().replace(/^\s+|\s+$/g, "").length == 0 || $("#content").val().replace(/^\s+|\s+$/g, "").length == 0) {
                        //                         alert("Title or Content not allowed to be empty");
                        //                     }
                        //                     else {
                        //                         title = $("#title").val();
                        //                         content = $("#content").val();
                        //                         tags = [$("#tags").val()];
                        //                         $.ajax({
                        //                             type: "PUT",
                        //                             url: "http://localhost:8000/articles/" + valueOfElement,
                        //                             data: JSON.stringify({
                        //                                 title: title,
                        //                                 content: content,
                        //                                 tags: tags
                        //                             }),
                        //                             contentType: "application/json",
                        //                             // dataType: "json",
                        //                             success: function (response) {
                        //                                 alert("Wiki updated successfully");
                        //                                 $("#form-edit").empty();
                        //                                 $("#back-to-details").hide();
                        //                                 $("#update").hide();
                        //                                 $("#data").show();
                        //                                 $("#add").show();
                        //                             },
                        //                             error: function () {
                        //                                 alert("Update failed");
                        //                             }
                        //                         });
                        //                     }
                        //                 });
                        //                 $("#back-to-details").unbind().click(function (e) {
                        //                     e.preventDefault();
                        //                     $("#form-edit").empty();
                        //                     $("#back-to-details").hide();
                        //                     $("#update").hide();
                        //                     $("#data-details").append("<h1>" + result.title + "</h1>");
                        //                     $("#data-details").append("<p>" + result.content + "</p>");
                        //                     $("#back").show();
                        //                     $("#edit").show();
                        //                     $("#delete").show();
                        //                 });
                        //                 $("#back-to-details").on('click', function () {
                        //                 });
                        //             });
                        //         }
                        //     });
                        // });
                    });
                }
            });
            $("#add").unbind().click(function (e) {
                $("#data").hide();
                $("#add").hide();
                $("#form-create").show();
                $("#cancel").show();
                $("#create").show();
                $("#cancel").unbind().click(function (e) {
                    e.preventDefault();
                    $("#data").show();
                    $("#add").show();
                    $("#cancel").hide();
                    $("#create").hide();
                    $("#form-create").hide();
                });
                $("#create").unbind().click(function (e) {
                    e.preventDefault();
                    if ($("#title-create").val().replace(/^\s+|\s+$/g, "").length == 0 || $("#content-create").val().replace(/^\s+|\s+$/g, "").length == 0) {
                        alert("Title or Content not allowed to be empty");
                    }
                    else {
                        title = $("#title-create").val();
                        content = $("#content-create").val();
                        tags = [$("#tags-create").val()];
                        $.ajax({
                            type: "POST",
                            url: "http://localhost:8000/articles",
                            data: JSON.stringify({
                                title: title,
                                content: content,
                                tags: tags
                            }),
                            dataType: "json",
                            contentType: "application/json",
                            success: function (response) {
                                alert("Wiki created successfully");
                                location.reload();
                                $("#add").show();
                                $("#form-create").hide();
                                $("#create").hide();
                                $("#cancel").hide();
                            },
                            error: function () {
                                alert("Failed create wiki");
                            }
                        });
                    }
                });
                console.log();
            });
            // $("#add").on('click', function () {
            //     // $("#data").hide();
            //     // $("#add").hide();
            //     // $("#data").append("<input placeholder='Title' type='text' id='title' required><br><br>");
            //     // $("#data").append("<input placeholder='Content' type='text' id='content' required><br><br>");
            //     // $("#data").append("<input placeholder='Tags' type='text' id='tags' required><br><br>");
            //     // $("#data").append("<button id='create'>Create</button>");
            //     // $("#data").append("<button id='cancel-add'>Cancel</button>");
            //     // $("#create").on('click', function () {

            //     //     $.ajax({
            //     //         type: "POST",
            //     //         url: "http://localhost:8000/articles",
            //     //         contentType: "application/json",
            //     //         data: JSON.stringify({
            //     //             title: $("#title").val(),
            //     //             content: $("#content").val(),
            //     //             tags: [$("#tags").val()]
            //     //         }),
            //     //         dataType: "json",
            //     //         success: function () {
            //     //             alert("Wiki created successfully");
            //     //             $("#data").empty();
            //     //             $("#add").show();
            //     //             $.ajax({
            //     //                 type: "GET",
            //     //                 url: "http://localhost:8000/articles",
            //     //                 dataType: "json",
            //     //                 success: function (response) {
            //     //                     $.each(response.url, function (indexInArray, valueOfElement) { 
            //     //                         $("#data").append("<h1>"+valueOfElement+"</h1>"); 
            //     //                     });
            //     //                 }
            //     //             });
            //     //         },
            //     //         error: function () { 
            //     //             alert("Something went wrong!");
            //     //         }
            //     //     });
            //     // });
            //     // $("#cancel-add").on('click', function () {
            //     //     $("#data").empty();
            //     //     $.ajax({
            //     //         type: "GET",
            //     //         url: "http://localhost:8000/articles",
            //     //         dataType: "json",
            //     //         success: function (response) {
            //     //             $.each(response.url, function (indexInArray, valueOfElement) { 
            //     //                 $("#data").append("<h1>"+valueOfElement+"</h1>");
            //     //                 $("h1").click(function () { 
            //     //                     alert(valueOfElement);
            //     //                     console.log(valueOfElement);
            //     //                 });
            //     //             });
            //     //         }
            //     //     });
            //     //     $("#add").show();
            //     // });
            // });
        });

    </script>
</body>

</html>